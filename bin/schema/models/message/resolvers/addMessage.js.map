{"version":3,"sources":["../../../../../src/schema/models/message/resolvers/addMessage.js"],"names":["requireAuth","createResolver","parent","args","models","user","message","Message","create","userId","id","asyncFunc","currentUser","User","findOne","where","pubsub","publish","MESSAGE_ADDED","channelId","messageAdded","dataValues","err","log","error"],"mappings":"6FAAA,wEACA,wDACA,oBACA,wE,ysBAEeA,wBAAYC,cAAZ,CACX,MAAOC,MAAP,CAAeC,IAAf,CAAqB,CAACC,MAAD,CAASC,IAAT,CAArB,GAAwC,CACpC,GAAI,CACA,KAAMC,CAAAA,OAAO,CAAG,KAAMF,CAAAA,MAAM,CAACG,OAAP,CAAeC,MAAf,kBACfL,IADe,EAElBM,MAAM,CAAEJ,IAAI,CAACK,EAFK,GAAtB,CAIA,KAAMC,CAAAA,SAAS,CAAG,SAAY,CAC1B,KAAMC,CAAAA,WAAW,CAAG,KAAMR,CAAAA,MAAM,CAACS,IAAP,CAAYC,OAAZ,CAAoB,CAC1CC,KAAK,CAAE,CACHL,EAAE,CAAEL,IAAI,CAACK,EADN,CADmC,CAApB,CAA1B,CAMAM,gBAAOC,OAAP,CAAeC,eAAf,CAA8B,CAC1BC,SAAS,CAAEhB,IAAI,CAACgB,SADU,CAE1BC,YAAY,kBACLd,OAAO,CAACe,UADH,EAERhB,IAAI,CAAEO,WAAW,CAACS,UAFV,EAFc,CAA9B,EAOH,CAdD,CAgBAV,SAAS,GACT,MAAO,KAAP,CACH,CAAC,MAAOW,GAAP,CAAY,CACVC,gBAAIC,KAAJ,CAAUF,GAAV,EACA,MAAO,MAAP,CACH,CACJ,CA7BU,C","sourcesContent":["import log from \"../../../../utils/logger\";\nimport {requireAuth} from \"../../../../utils/permission\";\nimport {MESSAGE_ADDED} from \"..\";\nimport pubsub from \"../../../../utils/pubsub\";\n\nexport default requireAuth.createResolver(\n    async (parent, args, {models, user}) => {\n        try {\n            const message = await models.Message.create({\n                ...args,\n                userId: user.id,\n            });\n            const asyncFunc = async () => {\n                const currentUser = await models.User.findOne({\n                    where: {\n                        id: user.id,\n                    },\n                });\n\n                pubsub.publish(MESSAGE_ADDED, {\n                    channelId: args.channelId,\n                    messageAdded: {\n                        ...message.dataValues,\n                        user: currentUser.dataValues,\n                    },\n                });\n            };\n\n            asyncFunc();\n            return true;\n        } catch (err) {\n            log.error(err);\n            return false;\n        }\n    },\n);\n"],"file":"addMessage.js"}