{"version":3,"sources":["../../src/utils/getUser.js"],"names":["req","res","next","models","headers","token","replace","user","jwt","verify","process","env","SECRET","err","refreshToken","newTokens","SECRET2","set"],"mappings":"6FAAA,4BACA,kE,gGAEe,MAAOA,GAAP,CAAYC,GAAZ,CAAiBC,IAAjB,CAAuBC,MAAvB,GAAkC,CAC7C,GAAIH,GAAG,CAACI,OAAJ,CAAY,SAAZ,CAAJ,CAA4B,CACxB,KAAMC,CAAAA,KAAK,CAAGL,GAAG,CAACI,OAAJ,CAAY,SAAZ,EAAuBE,OAAvB,CAA+B,SAA/B,CAA0C,EAA1C,CAAd,CAEA,GAAI,CACA,KAAM,CAACC,IAAD,EAASC,sBAAIC,MAAJ,CAAWJ,KAAX,CAAkBK,OAAO,CAACC,GAAR,CAAYC,MAA9B,CAAf,CAEAZ,GAAG,CAACO,IAAJ,CAAWA,IAAX,CACH,CAAC,MAAOM,GAAP,CAAY,CACV,KAAMC,CAAAA,YAAY,CAAGd,GAAG,CAACI,OAAJ,CAAY,iBAAZ,CAArB,CACA,KAAMW,CAAAA,SAAS,CAAG,KAAM,wBACpBV,KADoB,CAEpBS,YAAY,CAACR,OAAb,CAAqB,SAArB,CAAgC,EAAhC,CAFoB,CAGpBH,MAHoB,CAIpBO,OAAO,CAACC,GAAR,CAAYC,MAJQ,CAKpBF,OAAO,CAACC,GAAR,CAAYK,OALQ,CAAxB,CAQA,GAAID,SAAS,CAACV,KAAV,EAAmBU,SAAS,CAACD,YAAjC,CAA+C,CAC3Cb,GAAG,CAACgB,GAAJ,CACI,+BADJ,CAEI,0BAFJ,EAIAhB,GAAG,CAACgB,GAAJ,CAAQ,SAAR,CAAmBF,SAAS,CAACV,KAA7B,EACAJ,GAAG,CAACgB,GAAJ,CAAQ,iBAAR,CAA2BF,SAAS,CAACD,YAArC,EACH,CACDd,GAAG,CAACO,IAAJ,CAAWQ,SAAS,CAACR,IAArB,CACH,CACJ,CACDL,IAAI,GACP,C","sourcesContent":["import {refreshTokens} from \"./auth\";\nimport jwt from \"jsonwebtoken\";\n\nexport default async (req, res, next, models) => {\n    if (req.headers[\"x-token\"]) {\n        const token = req.headers[\"x-token\"].replace(\"Bearer \", \"\");\n\n        try {\n            const {user} = jwt.verify(token, process.env.SECRET);\n\n            req.user = user;\n        } catch (err) {\n            const refreshToken = req.headers[\"x-refresh-token\"];\n            const newTokens = await refreshTokens(\n                token,\n                refreshToken.replace(\"Bearer \", \"\"),\n                models,\n                process.env.SECRET,\n                process.env.SECRET2,\n            );\n\n            if (newTokens.token && newTokens.refreshToken) {\n                res.set(\n                    \"Access-Control-Expose-Headers\",\n                    \"x-token, x-refresh-token\",\n                );\n                res.set(\"x-token\", newTokens.token);\n                res.set(\"x-refresh-token\", newTokens.refreshToken);\n            }\n            req.user = newTokens.user;\n        }\n    }\n    next();\n};\n"],"file":"getUser.js"}