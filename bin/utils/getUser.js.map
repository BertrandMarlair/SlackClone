{"version":3,"sources":["../../src/utils/getUser.js"],"names":["req","res","next","models","headers","token","replace","user","jwt","verify","process","env","SECRET","err","refreshToken","newTokens","SECRET2","set"],"mappings":"6FAAA,4BACA,kE,gGAEe,MAAOA,GAAP,CAAYC,GAAZ,CAAiBC,IAAjB,CAAuBC,MAAvB,GAAkC,CAC7C,GAAIH,GAAG,CAACI,OAAJ,CAAY,SAAZ,CAAJ,CAA4B,CACxB,KAAMC,CAAAA,KAAK,CAAGL,GAAG,CAACI,OAAJ,CAAY,SAAZ,EAAuBE,OAAvB,CAA+B,SAA/B,CAA0C,EAA1C,CAAd,CACA,GAAI,CACA,KAAM,CAAEC,IAAF,EAAWC,sBAAIC,MAAJ,CAAWJ,KAAX,CAAkBK,OAAO,CAACC,GAAR,CAAYC,MAA9B,CAAjB,CACAZ,GAAG,CAACO,IAAJ,CAAWA,IAAX,CACH,CAAC,MAAOM,GAAP,CAAY,CACV,KAAMC,CAAAA,YAAY,CAAGd,GAAG,CAACI,OAAJ,CAAY,iBAAZ,CAArB,CACA,KAAMW,CAAAA,SAAS,CAAG,KAAM,wBAAcV,KAAd,CAAqBS,YAAY,CAACR,OAAb,CAAqB,SAArB,CAAgC,EAAhC,CAArB,CAA0DH,MAA1D,CAAkEO,OAAO,CAACC,GAAR,CAAYC,MAA9E,CAAsFF,OAAO,CAACC,GAAR,CAAYK,OAAlG,CAAxB,CACA,GAAID,SAAS,CAACV,KAAV,EAAmBU,SAAS,CAACD,YAAjC,CAA+C,CAC3Cb,GAAG,CAACgB,GAAJ,CAAQ,+BAAR,CAAyC,0BAAzC,EACAhB,GAAG,CAACgB,GAAJ,CAAQ,SAAR,CAAmBF,SAAS,CAACV,KAA7B,EACAJ,GAAG,CAACgB,GAAJ,CAAQ,iBAAR,CAA2BF,SAAS,CAACD,YAArC,EACH,CAEDd,GAAG,CAACO,IAAJ,CAAWQ,SAAS,CAACR,IAArB,CACH,CACJ,CACDL,IAAI,GACP,C","sourcesContent":["import { refreshTokens } from './auth';\nimport jwt from 'jsonwebtoken'\n\nexport default async (req, res, next, models) => {\n    if (req.headers['x-token']) {\n        const token = req.headers['x-token'].replace('Bearer ', '');\n        try {\n            const { user } = jwt.verify(token, process.env.SECRET)\n            req.user = user\n        } catch (err) {\n            const refreshToken = req.headers['x-refresh-token']\n            const newTokens = await refreshTokens(token, refreshToken.replace('Bearer ', ''), models, process.env.SECRET, process.env.SECRET2)\n            if (newTokens.token && newTokens.refreshToken) {\n                res.set('Access-Control-Expose-Headers', 'x-token, x-refresh-token')\n                res.set('x-token', newTokens.token)\n                res.set('x-refresh-token', newTokens.refreshToken)\n            }\n            // eslint-disable-next-line require-atomic-updates\n            req.user = newTokens.user\n        }\n    }\n    next()\n}"],"file":"getUser.js"}